<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Experiment Results</title>
  <style>
    body {font-family:Arial,sans-serif;margin:2rem;background:#f9f9f9;}
    .result {background:#fff;border:1px solid #ddd;border-radius:4px;
             padding:1rem;margin-bottom:1.5rem;box-shadow:0 2px 4px rgba(0,0,0,.05);}
    .header {font-weight:bold;margin-bottom:.5rem;font-size:1.1rem;}
    .badge {margin-left:.5rem;}
    .field {margin:.3rem 0;}
    .field span{font-weight:600;}
    pre {background:#f4f4f4;padding:.8rem;border-radius:4px;overflow:auto;}
  </style>
</head>
<body>

<h1>Experiment Results</h1>
<div id="container">Loading…</div>

<script>
(async () => {
  const container = document.getElementById('container');

  const dirResp = await fetch('./?list');
  const dirHtml = await dirResp.text();
  const doc     = new DOMParser().parseFromString(dirHtml, 'text/html');

  const jsonLinks = [...doc.querySelectorAll('a')]
    .map(a => a.getAttribute('href'))
    .filter(h => h && h.split('?')[0].toLowerCase().endsWith('.json'))
    .map(h => h.replace(/^\.?\//, '').replace(/\?.*$/, ''));

  if (jsonLinks.length === 0) {
    container.innerHTML = '<p>No JSON files found.</p>';
    return;
  }

  const results = await Promise.all(
    jsonLinks.map(async name => {
      const resp = await fetch(name);
      const data = await resp.json();
      return {...data, _filename: name};
    })
  );

  results.sort((a, b) => b._filename.localeCompare(a._filename));

  container.innerHTML = '';
  results.forEach(r => {
    const badge = r.passed ? '✅' : '❌';
    const el = document.createElement('div');
    el.className = 'result';
    el.innerHTML = `
      <div class="header">Experiment ID: ${r.id}
        <span class="badge">${badge}</span>
      </div>
      <div class="field"><span>Query:</span> ${r.query}</div>
      <div class="field"><span>Expected answer:</span> ${r.expected_answer}</div>
      <div class="field"><span>Output:</span></div>
      <pre>${r.output}</pre>
      <div class="field"><small>Source file: ${r._filename}</small></div>
    `;
    container.appendChild(el);
  });
})();
</script>

</body>
</html>