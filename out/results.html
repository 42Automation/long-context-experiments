<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Experiment Results</title>
  <style>
    :root {
      --bg: #111827;
      --surface: #1f2937;
      --border: #374151;
      --text: #f9fafb;
      --muted: #9ca3af;
      --accent: #3b82f6;
      --success: #22c55e;
      --error: #ef4444;
    }
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 2rem;
    }
    h1 { margin-top: 0; }
    .result {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
    }
    .header {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: .5rem;
    }
    .badge { margin-left: .5rem; }
    .field { margin: .4rem 0; }
    .field span { font-weight: 600; color: var(--muted); }
    pre {
      background: var(--bg);
      color: var(--text);
      padding: .8rem;
      border-radius: 6px;
      overflow: auto;
      font-size: .9rem;
    }
  </style>
</head>
<body>

<h1>Experiment Results</h1>
<div id="container">Loading…</div>

<script>
(async () => {
  const container = document.getElementById('container');

  const dirResp = await fetch('./?list');
  const dirHtml = await dirResp.text();
  const doc     = new DOMParser().parseFromString(dirHtml, 'text/html');

  const jsonLinks = [...doc.querySelectorAll('a')]
    .map(a => a.getAttribute('href'))
    .filter(h => h && h.split('?')[0].toLowerCase().endsWith('.json'))
    .map(h => h.replace(/^\.?\//, '').replace(/\?.*$/, ''));

  if (jsonLinks.length === 0) {
    container.innerHTML = '<p>No JSON files found.</p>';
    return;
  }

  const results = await Promise.all(
    jsonLinks.map(async name => {
      const resp = await fetch(name);
      const data = await resp.json();
      return {...data, _filename: name};
    })
  );

  // Sort by date
  //results.sort((a, b) => b._filename.localeCompare(a._filename));

  // Sort by id
  results.sort((a, b) => a.id.localeCompare(b.id));

  container.innerHTML = '';
  results.forEach(r => {
    const badge = r.passed ? '✅' : '❌';
    const el = document.createElement('div');
    el.className = 'result';
    el.innerHTML = `
      <div class="header">
        Experiment ID: ${r.id}
        <span class="badge">${badge}</span>
      </div>
      <div class="field"><span>Model:</span> ${r.model}</div>
      <div class="field"><span>Query:</span> ${r.query}</div>
      <div class="field"><span>Expected answer:</span> ${r.expected_answer}</div>
      <div class="field"><span>Output:</span></div>
      <pre>${r.output}</pre>
      <div class="field"><small>Source file: ${r._filename}</small></div>
    `;
    container.appendChild(el);
  });
})();
</script>

</body>
</html>